{% extends 'partials/base.html' %}
{% load static %}
{% block title %}Free Text-To-Speech for all languages & MP3 Download | ainhub.com/txt2mp4{% endblock %}
{% block description %}Easily convert text to natural US English voice and 150+ languages/accents for free. Listen
online or download as MP3.{% endblock %}
{% load humanize %}

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>



{% block content %}

<style>
    .text_container {
        max-width: 100%;
        overflow-x: auto;
    }

    table {
        width: 100%;
    }

    @media (max-width: 700px) {
        table {
            width: 80% !important;
            padding: 0px;
        }
    }
</style>

<body>

    {% include 'partials/header.html' %}

    <main class="main_area">


        {% include 'partials/dashbord_slider.html' %}






        <div class="main_content">

            <!-- <button id="toggleBtn0" class="toggle-btn">â˜°</button> -->
            {% include 'partials/message.html' %}
            {% include 'partials/success.html' %}
            {% include 'partials/dash_top_left_btn.html' %}

            <div class="page_content">
                <h2>Create New Survey</h2>


                <div class="text_container">
                    <div class="login_main">
                        <div class="login-container">
                            <form method="POST" class="login-form" enctype="multipart/form-data">
                                {% csrf_token %}
                                <!-- <h2>Transfer</h2> -->
                                <div class="input-group">
                                    <label for="title" class="form-label">Title</label>
                                    <input type="text" class="form-control" name="title" id="title" required>
                                </div>
                                <div class="input-group">
                                    <label for="title" class="form-label">Url</label>
                                    <input type="text" class="form-control" name="url" id="url" required>
                                </div>
                                <div class="input-group">
                                    <label for="description" class="form-label">Description</label>
                                    <textarea name="description" id="description" style="width: 98%;"
                                        rows="6"></textarea>
                                </div>

                                <div class="input-group">
                                    <label for="logo" class="form-label">Logo (optional)</label>
                                    <input type="file" class="form-control" name="logo">
                                </div>
                                <button type="submit" class="login_btn" id="create_survey" type="submit"
                                    class="btn btn-primary">Create Survey</button>



                            </form>
                        </div>
                    </div>
                </div>





            </div>



        </div>






    </main>





    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>

        function displayError(message) {
            const errorDiv = $("#error-message");
            errorDiv.html(message).show();
        }

        function displaySuccess(message) {
            const errorDiv = $("#success-message");
            errorDiv.html(message).show();
        }

        $("#create_survey").on("click", function (e) {
            e.preventDefault();

            const btn = document.getElementById("create_survey");
            btn.innerText = "Creating...";

            const title = $("#title").val();
            const description = $("#description").val();

            const csrf_token = $('input[name="csrfmiddlewaretoken"]').val();

            // Validate input
            if (!title || !description) {
                displayError("Please fill in all required fields.");
                displaySuccess("");
                btn.innerText = "Create Survey";
                return;
            }

            $.ajax({
                url: "{% url 'survey:create_survey' %}",  // your Django view URL
                method: 'POST',
                data: {
                    title: title,
                    description: description,
                    csrfmiddlewaretoken: csrf_token
                },
                success: function (response) {
                    displaySuccess("Success: " + response.message);
                    btn.innerText = "Create Survey";
                },
                error: function (xhr, status, error) {
                    console.log("XHR Status:", status);
                    console.log("XHR Response:", xhr.responseText);
                    console.log("XHR Error:", error);

                    let msg = "Something went wrong!";

                    try {
                        const response = JSON.parse(xhr.responseText);
                        if (response.message) {
                            msg = response.message;
                        } else if (response.detail) {
                            msg = response.detail;
                        }
                    } catch (e) {
                        msg = xhr.responseText;  // fallback to raw text if not JSON
                    }

                    displayError("Error: " + msg);
                    displaySuccess("");
                    btn.innerText = "Create Survey";
                }

            });
        });
    </script>







    <script>

        const toggleBtn = document.getElementById('toggleBtn');
        const toggledashboRDBtn = document.getElementById('toggledashboRDBtn');

        const dashbord_slider = document.getElementById('dashbord_slider');
        const overlay = document.getElementById('overlay');
        const mainContent = document.querySelector('.main_content');
        // sidebar.classList.toggle('open');
        // overlay.classList.toggle('show');
        toggleBtn.addEventListener('click', () => {
            // alert("Ho");
            dashbord_slider.classList.toggle('hidden');
            // mainContent.classList.toggle('expanded');
        });

        toggledashboRDBtn.addEventListener('click', () => {
            dashbord_slider.classList.toggle('hidden');
        });

    </script>




</body>

{% endblock %}

</html>