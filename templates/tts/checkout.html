<script src="https://www.paypal.com/sdk/js?client-id={{ paypal_client_id }}&currency=USD"></script>

<h2>Subscribe to {{ plan.name }}</h2>
<div id="paypal-button-container"></div>

<script>
paypal.Buttons({
    createOrder: function(data, actions) {
        return actions.order.create({
            purchase_units: [{
                amount: {
                    value: '{{ plan.price }}'
                }
            }]
        });
    },
    onApprove: function(data, actions) {
        return actions.order.capture().then(function(details) {
            // Send data to Django view
            fetch("{% url 'payment_complete' %}", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                body: JSON.stringify({
                    plan_id: '{{ plan.id }}',
                    order_id: data.orderID
                })
            }).then(() => {
                alert("Payment successful!");
                window.location.href = "/";
            });
        });
    }
}).render('#paypal-button-container');
</script>
